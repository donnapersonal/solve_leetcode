# 166.Fraction to Recurring Decimal

## LeetCode 题目链接

[166.分数到小数](https://leetcode.cn/problems/fraction-to-recurring-decimal/)

## 题目大意

给定两个整数，分别表示分数的分子 `numerator` 和分母 `denominator`，以 字符串形式返回小数 

如果小数部分为循环小数，则将循环的部分括在括号内

如果存在多个答案，只需返回 任意一个 

对于所有给定的输入，保证 答案字符串的长度小于 `10^4` 

```js
Example 1:
Input: numerator = 1, denominator = 2
Output: "0.5"

Example 2:
Input: numerator = 2, denominator = 1
Output: "2"

Example 3:
Input: numerator = 4, denominator = 333
Output: "0.(012)"
```

限制:
- -2^31 <= numerator, denominator <= 2^31 - 1
- denominator != 0

## 解题

将分数转成整数或小数，做法是计算分子和分母相除的结果。可能的结果有三种：`整数`、`有限小数`、`无限循环小数`
- 如果分子可被分母整除，则结果是整数，将分子除以分母的商以字符串的形式返回即可
- 如果分子不能被分母整除，则结果是有限小数或无限循环小数，需通过模拟除法的方式计算结果

核心思路 - 将分数 `numerator / denominator` 转换为小数表示的字符串形式，主要处理以下几种情况：
- 符号判断：结果为负时，开头加 `'-'`
- 整数部分：用整数除法 `divmod(numerator, denominator)` 得到整数部分
- 小数部分：
  - 用模拟除法方式逐步取余再乘 `10` 取下一位
  - 用哈希表 `remainder -> position` 跟踪每一个余数出现的位置
  - 如果余数重复出现，说明小数开始循环，从第一次出现的位置插入括号

```js
var fractionToDecimal = function(numerator, denominator) {
    if (numerator === 0) return "0";
    let res = "";
    if (Math.sign(numerator) !== Math.sign(denominator)) {
        res += "-";
    }
    numerator = Math.abs(numerator);
    denominator = Math.abs(denominator);
    let integerPart = Math.floor(numerator / denominator);
    res += integerPart;
    let remainder = numerator % denominator;

    if (remainder === 0) return res;
    res += ".";
    const map = new Map();
    while (remainder !== 0) {
        if (map.has(remainder)) {
            let index = map.get(remainder);
            res = res.slice(0, index) + "(" + res.slice(index) + ")";
            break;
        }

        map.set(remainder, res.length);
        remainder *= 10;
        res += Math.floor(remainder / denominator);
        remainder %= denominator;
    }

    return res;
};
```
```python
class Solution:
    def fractionToDecimal(self, numerator: int, denominator: int) -> str:
        if numerator == 0:
            return "0"

        res = []
        if (numerator < 0) ^ (denominator < 0):
            res.append("-")

        numerator = abs(numerator)
        denominator = abs(denominator)

        integer_part, remainder = divmod(numerator, denominator)
        res.append(str(integer_part))

        if remainder == 0:
            return ''.join(res)

        res.append(".")
        remainder_map = {}  
        while remainder:
            if remainder in remainder_map:
                res.insert(remainder_map[remainder], "(")
                res.append(")")
                break

            remainder_map[remainder] = len(res)
            remainder *= 10
            digit, remainder = divmod(remainder, denominator)
            res.append(str(digit))

        return ''.join(res)
```

- 时间复杂度：`O(n)`，其中 `n` 是答案字符串的长度
  - 这道题中 `n ≤ 10^4`，对于答案字符串中的每一个字符，计算时间都是 `O(1)`
- 空间复杂度：`O(n)`，其中 `n` 是答案字符串的长度
  - 这道题中 `n ≤ 10^4`
  - 空间复杂度主要取决于答案字符串和哈希表，哈希表中的每个键值对所对应的下标各不相同，因此键值对的数量不会超过 `n`